window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}()),Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(a){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var a=document.createElement("div");return a.style.fontFamily="monospace",a.style.fontSize="13px",a.style.textAlign="center",a.style.background="#eee",a.style.color="#000",a.style.padding="1em",a.style.width="475px",a.style.margin="5em auto 0",this.webgl||(a.innerHTML=window.WebGLRenderingContext?"Your graphics card does not seem to support <a href=\"http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation\">WebGL</a>.<br />\nFind out how to get it <a href=\"http://get.webgl.org/\">here</a>.":"Your browser does not seem to support <a href=\"http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation\">WebGL</a>.<br/>\nFind out how to get it <a href=\"http://get.webgl.org/\">here</a>."),a},addGetWebGLMessage:function(a){var b,c,d;a=a||{},b=a.parent===void 0?document.body:a.parent,c=a.id===void 0?"oldie":a.id,d=Detector.getWebGLErrorMessage(),d.id=c,b.appendChild(d)}},THREE.PTZCameraControls=function(a,b){var A=Math.sqrt,B=Math.PI,C=Math.max,D=Math.min;function c(){return Math.pow(.95,E.zoomSpeed)}function d(a){E.translate?E.camera.position.x-=a:E.camera.rotation.y-=a,E.dispatchEvent(G)}function e(a){E.translate?E.camera.position.y+=a:E.camera.rotation.x=C(E.minTilt,D(E.maxTilt,E.camera.rotation.x-a)),E.dispatchEvent(G)}function f(a){E.camera.zoom=C(E.minZoom,D(E.maxZoom,E.camera.zoom*a)),E.camera.updateProjectionMatrix(),E.dispatchEvent(G)}function g(a){E.camera.zoom=C(E.minZoom,D(E.maxZoom,E.camera.zoom/a)),E.camera.updateProjectionMatrix(),E.dispatchEvent(G)}function h(a){K.set(a.clientX,a.clientY)}function i(a){N.set(a.clientX,a.clientY)}function j(a){L.set(a.clientX,a.clientY),M.subVectors(L,K);var b=E.domElement===document?E.domElement.body:E.domElement;d(2*B*M.x/b.clientWidth*E.panSpeed),e(2*B*M.y/b.clientHeight*E.tiltSpeed),K.copy(L)}function k(a){O.set(a.clientX,a.clientY),P.subVectors(O,N),0<P.y?f(c()):0>P.y&&g(c()),N.copy(O)}function l(){}function m(a){0>a.deltaY?g(c()):0<a.deltaY&&f(c())}function n(a){K.set(a.touches[0].pageX,a.touches[0].pageY)}function o(a){var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY,d=A(b*b+c*c);N.set(0,d)}function p(a){L.set(a.touches[0].pageX,a.touches[0].pageY),M.subVectors(L,K);var b=E.domElement===document?E.domElement.body:E.domElement;d(2*B*M.x/b.clientWidth*E.panSpeed),e(2*B*M.y/b.clientHeight*E.tiltSpeed),K.copy(L)}function q(a){var b=a.touches[0].pageX-a.touches[1].pageX,d=a.touches[0].pageY-a.touches[1].pageY,e=A(b*b+d*d);O.set(0,e),P.subVectors(O,N),0<P.y?g(c()):0>P.y&&f(c()),N.copy(O)}function r(){}function s(a){if(!1!==E.enabled){switch(a.preventDefault(),a.button){case E.mouseButtons.PAN_TILT:if(!1===E.enableRotate)return;h(a),J=I.PAN_TILT;break;case E.mouseButtons.ZOOM:if(!1===E.enableZoom)return;i(a),J=I.ZOOM;break;case E.mouseButtons.SELECT:J=I.NONE;var b=E.domElement.getBoundingClientRect();F.x=a.clientX-b.left,F.y=a.clientY-b.top,E.dispatchEvent(F);}J!==I.NONE&&(document.addEventListener("mousemove",t,!1),document.addEventListener("mouseup",u,!1))}}function t(a){if(!1!==E.enabled)switch(a.preventDefault(),J){case I.PAN_TILT:if(!1===E.enableRotate)return;j(a);break;case I.ZOOM:if(!1===E.enableZoom)return;k(a);}}function u(a){!1===E.enabled||(l(a),document.removeEventListener("mousemove",t,!1),document.removeEventListener("mouseup",u,!1),J==I.PAN_TILT&&E.dispatchEvent(H),J=I.NONE)}function v(a){!1===E.enabled||!1===E.enableZoom||J!==I.NONE&&J!==I.PAN_TILT||(a.preventDefault(),a.stopPropagation(),m(a))}function w(a){if(!1!==E.enabled)switch(a.touches.length){case 1:if(!1===E.enableRotate)return;n(a),J=I.TOUCH_PAN_TILT;break;case 2:if(!1===E.enableZoom)return;o(a),J=I.TOUCH_ZOOM;break;default:J=I.NONE;}}function x(a){if(!1!==E.enabled)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:if(!1===E.enableRotate)return;if(J!==I.TOUCH_PAN_TILT)return;p(a);break;case 2:if(!1===E.enableZoom)return;if(J!==I.TOUCH_ZOOM)return;q(a);break;default:J=I.NONE;}}function y(a){!1===E.enabled||(r(a),J=I.NONE)}function z(a){!1===E.enabled||a.preventDefault()}a.rotation.order="YXZ",this.camera=a,this.domElement=b===void 0?document:b,this.enabled=!0,this.translate=!1,this.minTilt=-B/2,this.maxTilt=B/2,this.minZoom=0,this.maxZoom=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enablePan=!0,this.panSpeed=1,this.enableTilt=!0,this.tiltSpeed=1,this.enableZoom=!0,this.zoomSpeed=1,this.mouseButtons={PAN_TILT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,SELECT:THREE.MOUSE.RIGHT},this.dispose=function(){E.domElement.removeEventListener("contextmenu",z,!1),E.domElement.removeEventListener("mousedown",s,!1),E.domElement.removeEventListener("wheel",v,!1),E.domElement.removeEventListener("touchstart",w,!1),E.domElement.removeEventListener("touchend",y,!1),E.domElement.removeEventListener("touchmove",x,!1),document.removeEventListener("mousemove",t,!1),document.removeEventListener("mouseup",u,!1)};var E=this,F={type:"select"},G={type:"change"},H={type:"rotate"},I={NONE:-1,PAN_TILT:0,ZOOM:1,TOUCH_PAN_TILT:2,TOUCH_ZOOM:3},J=I.NONE,K=new THREE.Vector2,L=new THREE.Vector2,M=new THREE.Vector2,N=new THREE.Vector2,O=new THREE.Vector2,P=new THREE.Vector2;E.domElement.addEventListener("contextmenu",z,!1),E.domElement.addEventListener("mousedown",s,!1),E.domElement.addEventListener("wheel",v,!1),E.domElement.addEventListener("touchstart",w,!1),E.domElement.addEventListener("touchend",y,!1),E.domElement.addEventListener("touchmove",x,!1)},THREE.PTZCameraControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.PTZCameraControls.prototype.constructor=THREE.PTZCameraControls;function Matterport3D(a){this.data_dir="undefined"==typeof a?"v1/scans/":a}Matterport3D.prototype.load_mesh=function(a,b,c){var d=this.data_dir+scan+"/matterport_mesh/"+mesh+"/",e=d+mesh+".obj",f=d+mesh+".mtl",g=new THREE.MTLLoader;g.setTexturePath(this.data_dir+scan+"/matterport_mesh/"+mesh+"/"),g.load(f,function(a){a.preload();var b=new THREE.OBJLoader;b.setMaterials(a),b.load(e,function(a){c(a)})})},Matterport3D.prototype.loadCubeTexture=function(a){return new Promise(function(b,c){var d=new THREE.CubeTextureLoader;d.setCrossOrigin("anonymous"),d.load(a,function(a){return b(a)},null,function(a){return c(a)})})},Matterport3D.prototype.loadJson=function(a){return new Promise(function(b,c){d3.json(a,function(a,d){a?c(a):b(d)})})},Matterport3D.prototype.load_viewpoints=function(a,{h:b=.5,opacity:c=.7}={}){for(var d,e=new THREE.Group,f=0;f<a.length;f++){d=a[f].pose;for(var g=0;g<d.length;g++)d[g]=parseFloat(d[g]);var h=parseFloat(a[f].height);d[11]-=h;var j=new THREE.Matrix4;j.fromArray(d),j.transpose();var l=new THREE.CylinderBufferGeometry(.15,.15,b,128),m=new THREE.MeshLambertMaterial({color:255});m.transparent=!0,m.opacity=c;var n=new THREE.Mesh(l,m);n.applyMatrix(j),n.height=h,n.name=a[f].image_id,e.add(n),n.included=!0,a[f].hasOwnProperty("included")&&!1==a[f].included&&(n.included=!1)}return e};